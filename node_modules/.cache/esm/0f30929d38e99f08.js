let cors,express,helmet,json,RegisterControllers,Paths,RegisterSocketHandlers,Auth0Provider,logger,AccountValidator;_38e‍.x([["Startup",()=>Startup]]);_38e‍.w("cors",[["default",["cors"],function(v){cors=v}]]);_38e‍.w("express",[["default",["express"],function(v){express=v}]]);_38e‍.w("helmet",[["default",["helmet"],function(v){helmet=v}]]);_38e‍.w("body-parser",[["json",["json"],function(v){json=v}]]);_38e‍.w("../Setup",[["RegisterControllers",["RegisterControllers"],function(v){RegisterControllers=v}],["Paths",["Paths"],function(v){Paths=v}],["RegisterSocketHandlers",["RegisterSocketHandlers"],function(v){RegisterSocketHandlers=v}]]);_38e‍.w("@bcwdev/auth0provider",[["Auth0Provider",["Auth0Provider"],function(v){Auth0Provider=v}]]);_38e‍.w("./utils/Logger",[["logger",["logger"],function(v){logger=v}]]);_38e‍.w("./utils/AccountValidator",[["AccountValidator",["AccountValidator"],function(v){AccountValidator=v}]]);








       class Startup {
  static ConfigureGlobalMiddleware(app) {
    // NOTE Configure and Register Middleware
    Startup.configureCors(app)
    app.use(helmet({
      contentSecurityPolicy: false
    }))
    app.use(json({ limit: '50mb' }))

    // NOTE Configures auth0 middleware that is used throughout controllers
    Auth0Provider.configure({
      domain: process.env.AUTH_DOMAIN,
      clientId: process.env.AUTH_CLIENT_ID,
      audience: process.env.AUTH_AUDIENCE
    })
  }

  static configureCors(app) {
    const allowedDomains = []
    const corsOptions = {
      origin(origin, callback) {
        if (process.env.NODE_ENV === 'dev') {
          return callback(null, true)
        }
        const originIsWhitelisted = allowedDomains.indexOf(origin) !== -1
        callback(null, originIsWhitelisted)
      },
      credentials: true
    }

    app.use(cors(corsOptions))
  }

  static ConfigureRoutes(app) {
    const router = express.Router()
    app.use(AccountValidator)
    RegisterControllers(router)
    RegisterSocketHandlers()
    app.use(router)

    app.use('', express.static(Paths.Public))

    Startup.registerErrorHandlers(app)
  }

  static registerErrorHandlers(app) {
    // NOTE SEND JSON 404 for any unknown routes
    app.use('/api', (_, res, next) => {
      res.status(404).send({ status: 404, message: 'Not Found' })
    })

    // NOTE SEND HTML 404 for any unknown routes
    app.use(
      '*',
      (_, res, next) => {
        res.status(404)
        next()
      },
      express.static(Paths.Public + '404')
    )
    // NOTE Default Error Handler
    app.use((error, req, res, next) => {
      if (!error.status) {
        error.status = 400
      }
      if (error.status === 500) {
        logger.error(error)
      }
      res.status(error.status).send({ error: { message: error.toString(), status: error.status }, url: req.url })
    })
  }
}
